<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Mi Auto</title>
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22ControlAuto%22,%22short_name%22:%22MiAuto%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#ffffff%22,%22theme_color%22:%22#2563eb%22}">
    <style>
        :root { --primary: #2563eb; --danger: #ef4444; --success: #22c55e; --bg: #f1f5f9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: auto; }
        .card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 6px solid #cbd5e1; }
        .vencido { border-left-color: var(--danger); }
        .al-dia { border-left-color: var(--success); }
        .form-group { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input, select, button { width: 100%; padding: 12px; margin-top: 8px; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; margin-top: 15px; cursor: pointer; }
        .historial-item { font-size: 0.85rem; padding: 8px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        h2, h3 { color: #1e293b; margin-top: 25px; }
    </style>
</head>
<body>

<div class="container">
    <h2>游뚱 Mi Control Automotriz</h2>

    <div class="form-group">
        <h3>Registrar Mantenimiento</h3>
        <label>Kilometraje Actual</label>
        <input type="number" id="kmInput" placeholder="Ej: 105000">
        
        <label>Fecha del Servicio</label>
        <input type="date" id="fechaInput">
        
        <label>Tipo de Servicio</label>
        <select id="servicioSelect">
            <optgroup label="Motor y Filtros">
                <option value="aceite">Aceite y Filtro (6 meses / 10k km)</option>
                <option value="bujias">Buj칤as (12 meses / 20k km)</option>
                <option value="niveles">Niveles de Fluidos (Mensual)</option>
            </optgroup>
            <optgroup label="Llantas y Suspensi칩n">
                <option value="alineacion">Alineaci칩n y Balanceo (10k km)</option>
                <option value="llantaDD">Llanta Delantera Derecha (5 a침os)</option>
                <option value="llantaDI">Llanta Delantera Izquierda (5 a침os)</option>
                <option value="llantaTD">Llanta Trasera Derecha (5 a침os)</option>
                <option value="llantaTI">Llanta Trasera Izquierda (5 a침os)</option>
            </optgroup>
            <optgroup label="Frenos">
                <option value="tambor">Frenos de Tambor (100k km)</option>
                <option value="luces">Luces y Frenos Gral.</option>
            </optgroup>
        </select>
        
        <button onclick="guardarServicio()">Guardar en Historial</button>
    </div>

    <h3>Estatus Actual</h3>
    <div id="listaEstatus"></div>

    <h3>游닆 Historial Reciente</h3>
    <div id="historialLista" class="card"></div>
    
    <button onclick="borrarTodo()" style="background:#64748b; font-size: 0.7rem; padding: 5px;">Reiniciar App</button>
</div>

<script>
    const CONFIG = {
        aceite: { nombre: "Aceite y Filtro", km: 10000, meses: 6 },
        bujias: { nombre: "Buj칤as", km: 20000, meses: 12 },
        niveles: { nombre: "Niveles de Fluidos", km: null, meses: 1 },
        alineacion: { nombre: "Alineaci칩n y Balanceo", km: 10000, meses: null },
        llantaDD: { nombre: "Llanta Delantera Der.", km: null, meses: 60 },
        llantaDI: { nombre: "Llanta Delantera Izq.", km: null, meses: 60 },
        llantaTD: { nombre: "Llanta Trasera Der.", km: null, meses: 60 },
        llantaTI: { nombre: "Llanta Trasera Izq.", km: null, meses: 60 },
        tambor: { nombre: "Frenos de Tambor", km: 100000, meses: null },
        luces: { nombre: "Luces y Frenos Gral.", km: 10000, meses: 6 }
    };

    let historial = JSON.parse(localStorage.getItem('historialAuto')) || [];

    function guardarServicio() {
        const km = parseInt(document.getElementById('kmInput').value);
        const tipo = document.getElementById('servicioSelect').value;
        const fInput = document.getElementById('fechaInput').value;
        const fecha = fInput ? new Date(fInput + "T12:00:00").toISOString() : new Date().toISOString();

        if (!km) return alert("Ingresa el kilometraje actual");

        historial.push({ tipo, km, fecha });
        historial.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
        
        localStorage.setItem('historialAuto', JSON.stringify(historial));
        renderizar();
        alert("Servicio guardado correctamente");
    }

    function renderizar() {
        const estatusDiv = document.getElementById('listaEstatus');
        const historialDiv = document.getElementById('historialLista');
        const hoy = new Date();
        const kmActual = historial.length > 0 ? Math.max(...historial.map(h => h.km)) : 0;

        estatusDiv.innerHTML = "";
        for (let key in CONFIG) {
            const config = CONFIG[key];
            const registrosTipo = historial.filter(h => h.tipo === key);
            const ultimo = registrosTipo[0];
            
            let vencido = !ultimo;
            if (ultimo) {
                if (config.km && (kmActual - ultimo.km) >= config.km) vencido = true;
                if (config.meses) {
                    let limite = new Date(ultimo.fecha);
                    limite.setMonth(limite.getMonth() + config.meses);
                    if (hoy > limite) vencido = true;
                }
            }

            estatusDiv.innerHTML += `
                <div class="card ${vencido ? 'vencido' : 'al-dia'}">
                    <strong>${config.nombre}</strong> <br>
                    <small>${ultimo ? `칔ltimo: ${ultimo.km}km (${new Date(ultimo.fecha).toLocaleDateString()})` : 'Sin registros'}</small>
                </div>`;
        }

        historialDiv.innerHTML = historial.length > 0 ? "" : "No hay servicios registrados.";
        historial.slice(0, 10).forEach(h => {
            historialDiv.innerHTML += `
                <div class="historial-item">
                    <span>${CONFIG[h.tipo].nombre}</span>
                    <span style="color:#64748b">${h.km} km | ${new Date(h.fecha).toLocaleDateString()}</span>
                </div>`;
        });
    }

    function borrarTodo() {
        if(confirm("쯉eguro que quieres borrar todo?")) {
            localStorage.clear();
            historial = [];
            renderizar();
        }
    }

    renderizar();
</script>
</body>
</html>
